name: YAML M09ç²¾éˆ

on:
  workflow_dispatch:

jobs:
  GSAC_job:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: æ‹‰å–ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      - name: å®‰è£ GitHub CLI èˆ‡ jq
        run: |
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg \
            | sudo gpg --dearmor -o /usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" \
            | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt update && sudo apt install gh jq -y

      - name: è¨­å®š GitHub CLI é©—è­‰
        run: echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: ç¢ºèªä»»å‹™æ¸…å–®æª”æ¡ˆ
        run: |
          ls GSACè³é‡‘ä»»å‹™/823-ä»»å‹™æ¸…å–®.md

      - name: æ‰¹æ¬¡æŠ“å–ä¸¦ç”Ÿæˆ M09.json
        run: |
          echo "[" > 823-M09-æƒ…å ±æª”æ¡ˆ.json
          total=$(grep -cE '^https://github\.com/' GSACè³é‡‘ä»»å‹™/823-ä»»å‹™æ¸…å–®.md || echo 0)
          echo "å…±éœ€è™•ç† $total å€‹ Issue"
          counter=0
          while read url; do
            [ -z "$url" ] && continue
            repo=$(echo "$url" | sed 's|https://github.com/||;s|/issues.*||')
            num=$(echo "$url" | awk -F'/' '{print $NF}')
            [ $counter -gt 0 ] && echo "," >> 823-M09-æƒ…å ±æª”æ¡ˆ.json
            echo "ğŸ” æŠ“å– $repo#$num"
            gh issue view "$repo#$num" \
              --json number,title,body,comments,labels,assignees,createdAt,updatedAt,htmlUrl \
              >> 823-M09-æƒ…å ±æª”æ¡ˆ.json
            counter=$((counter+1))
          done < GSACè³é‡‘ä»»å‹™/823-ä»»å‹™æ¸…å–®.md
          echo "]" >> 823-M09-æƒ…å ±æª”æ¡ˆ.json
          echo "âœ… å·²ç”Ÿæˆ 823-M09-æƒ…å ±æª”æ¡ˆ.jsonï¼Œå…± $counter æ¢"

      - name: é©—è­‰ JSON æ ¼å¼
        run: |
          jq empty 823-M09-æƒ…å ±æª”æ¡ˆ.json || (echo "JSON æ ¼å¼éŒ¯èª¤" && exit 1)

      - name: ä¸Šå‚³æˆæœ
        uses: actions/upload-artifact@v4
        with:
          name: 823-M09-æƒ…å ±æª”æ¡ˆ
          path: 823-M09-æƒ…å ±æª”æ¡ˆ.json

