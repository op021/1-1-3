name: YAML-00ç²¾éˆ

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  fetch_issues_and_create_m09:
    runs-on: ubuntu-latest

    steps:
      - name: æª¢æŸ¥ä¸¦æ‹‰å–ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      - name: å®‰è£å·¥å…·
        run: sudo apt-get update && sudo apt-get install -y gh jq

      - name: æŠ“å–ä¸¦ç”Ÿæˆ M09.json æª”æ¡ˆ
        run: |
          echo "ğŸš€ PDç²¾éˆå•Ÿå‹•ä¸­... æ­£åœ¨è™•ç†ä»»å‹™æ¸…å–®"
          
          # é€™è£¡å°±æ˜¯é—œéµï¼æˆ‘å€‘æ˜ç¢ºæŒ‡å®šäº†æ–‡ä»¶çš„æ–°ä½ç½®
          urls=$(grep -Eo 'https://github\.com/[^ ]+' "inputs/823-ä»»å‹™æ¸…å–®.md")

          if [ -z "$urls" ]; then
            echo "âŒ éŒ¯èª¤ï¼šåœ¨è¼¸å…¥æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°ä»»ä½•ç¶²å€ã€‚è«‹æª¢æŸ¥æª”æ¡ˆå…§å®¹ã€‚"
            exit 1
          fi

          echo "[" > M09.json
          
          first_url=true
          for url in $urls; do
            if [ "$first_url" = false ]; then
              echo "," >> M09.json
            fi
            
            owner_repo=$(echo "$url" | awk -F'/issues' '{print $1}' | cut -d'/' -f4,5)
            issue_number=$(echo "$url" | awk -F'/' '{print $NF}')
            
            echo "â¡ï¸ æ­£åœ¨æŠ“å– ${owner_repo}#${issue_number} çš„è³‡æ–™..."
            
            # ä½¿ç”¨ gh cli æŠ“å– JSON è³‡æ–™
            gh issue view "${owner_repo}#${issue_number}" \
              --json number,title,body,comments,labels,assignees,createdAt,updatedAt,htmlUrl \
              >> M09.json
              
            first_url=false
          done
          
          echo "]" >> M09.json
          
          echo "âœ… ä»»å‹™å®Œæˆï¼M09.json å·²æˆåŠŸç”Ÿæˆï¼"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ä¸Šå‚³æƒ…å ±æª”æ¡ˆè‡³ GitHub
        uses: actions/upload-artifact@v4
        with:
          name: 823-M09-æƒ…å ±æª”æ¡ˆ
          path: M09.json
