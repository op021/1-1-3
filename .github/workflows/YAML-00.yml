name: YAML M09ç²¾éˆä¿®æ­£ç‰ˆ

on:
  workflow_dispatch:

jobs:
  GSACä»»å‹™è™•ç†:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    steps:
      - name: æ‹‰å–ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      - name: å®‰è£å·¥å…·
        run: sudo apt-get update && sudo apt-get install -y gh jq

      - name: æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨
        run: |
          if [ ! -f "GSACè³é‡‘ä»»å‹™/823 ä»»å‹™æ¸…å–®.md" ]; then
            echo "âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° GSACè³é‡‘ä»»å‹™/823-ä»»å‹™æ¸…å–®.md"
            exit 1
          fi

      - name: æŠ“å–ä¸¦ç”Ÿæˆ JSON
        run: |
          echo "[" > M09.json
          first=true
          grep -Eo 'https://github\.com/[^ ]+' "GSACè³é‡‘ä»»å‹™/823-ä»»å‹™æ¸…å–®.md" | while read url; do
            repo=$(echo "$url" | cut -d'/' -f4,5)
            issue=$(echo "$url" | awk -F'/' '{print $NF}')
            if [ "$first" = false ]; then echo "," >> M09.json; fi
            echo "ğŸ” æŠ“å–ä¸­ï¼š$repo#$issue"
            gh issue view "$repo#$issue" \
              --json number,title,body,comments,labels,assignees,createdAt,updatedAt,htmlUrl \
              >> M09.json
            first=false
          done
          echo "]" >> M09.json
          echo "âœ… M09.json å·²æˆåŠŸç”Ÿæˆï¼"

      - name: ä¸Šå‚³æˆæœ
        uses: actions/upload-artifact@v4
        with:
          name: 823-M09æƒ…å ±æª”æ¡ˆ
          path: M09.json
