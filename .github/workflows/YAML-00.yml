name: M09 Generator

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Parse task code
        run: |
          CODE="823-001"
          DATE=$(echo $CODE | cut -d'-' -f1)
          INDEX=$(echo $CODE | cut -d'-' -f2)
          MONTH=$(echo $DATE | cut -c1)
          DAY=$(echo $DATE | cut -c2-3)

          echo "DATE=2025-${MONTH}-${DAY}" >> $GITHUB_ENV
          echo "INDEX=${INDEX}" >> $GITHUB_ENV
          echo "CODE=${CODE}" >> $GITHUB_ENV

      - name: Verify input file
        run: |
          if [ ! -f "GSAC-00/${CODE}" ]; then
            echo "Input file GSAC-00/${CODE} not found."
            exit 1
          fi

      - name: Generate JSON
        run: python scripts/generate_json.py GSAC-00/${CODE}

      - name: Validate JSON
        run: python scripts/validate_json.py output/${CODE}.json

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${CODE}-output
          path: output/${CODE}.json


